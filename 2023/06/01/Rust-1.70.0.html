<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Announcing Rust 1.70.0 | Rust Blog</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="description" content="Empowering everyone to build reliable and efficient software.">
     <!-- Twitter card -->
 <meta name="twitter:card" content="summary">
 <meta name="twitter:site" content="@rustlang">
 <meta name="twitter:creator" content="@rustlang">
 <meta name="twitter:title" content="Announcing Rust 1.70.0 | Rust Blog">
 <meta name="twitter:description" content="Empowering everyone to build reliable and efficient software.">
<meta name="twitter:image" content="https://www.rust-lang.org/static/images/rust-social.jpg">

<!-- Facebook OpenGraph -->
<meta property="og:title" content="Announcing Rust 1.70.0 | Rust Blog" />
<meta property="og:description" content="Empowering everyone to build reliable and efficient software.">
<meta property="og:image" content="https://www.rust-lang.org/static/images/rust-social-wide.jpg" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />

<!-- styles -->
<link rel="stylesheet" href="../../../styles/vendor.css"/>
<link rel="stylesheet" href="../../../styles/fonts.css"/>
<link rel="stylesheet" href="../../../styles/app.css"/>
<link rel="stylesheet" href="../../../styles/highlight.css"/>

<!-- favicon -->
<link rel="apple-touch-icon" sizes="180x180" href="../../../images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../../images/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../../images/favicon-32x32.png">
<link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
<link rel="manifest" href="../../../images/site.webmanifest">
<link rel="mask-icon" href="../../../images/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#00aba9">
<meta name="theme-color" content="#ffffff">

 <!-- atom -->
 <link type="application/atom+xml" rel="alternate" href="https://blog.rust-lang.org/feed.xml" title="Rust Blog" />

  </head>
  <body>
    <nav class="flex flex-row justify-center justify-end-l items-center flex-wrap ph2 pl3-ns pr4-ns">
  <div class="brand flex-auto w-100 w-auto-l self-start tc tl-l">
    <a href="../../../">
      <img class="v-mid ml0-l" alt="Rust Logo" src="../../../images/rust-logo-blk.svg">
      <span class="dib ml1 ml0-l">Rust Blog</span>
    </a>
  </div>

  <ul class="nav list w-100 w-auto-l flex flex-none flex-row flex-wrap justify-center justify-end-l items-center pv2 ph0 ph4-ns">
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org">Rust</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/tools/install">Install</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/learn">Learn</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/tools">Tools</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/governance">Governance</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/community">Community</a></li>
  </ul>
</nav>

<section id="Announcing Rust 1.70.0" class="white">
  <div class="w-100 mw-none ph3 mw8-m mw8-l center f3">
    <header>
      <h2>Announcing Rust 1.70.0</h2>
      <div class="highlight mt2 mb3"></div>
    </header>

    <div class="publish-date-author">June 1, 2023 &middot; The Rust Release Team
    
    </div>

    <div class="post">
      <p>The Rust team is happy to announce a new version of Rust, 1.70.0. Rust is a programming language empowering everyone to build reliable and efficient software.</p>
<p>If you have a previous version of Rust installed via rustup, you can get 1.70.0 with:</p>
<pre><code class="language-console">rustup update stable
</code></pre>
<p>If you don't have it already, you can <a href="https://www.rust-lang.org/install.html">get <code>rustup</code></a> from the appropriate page on our website, and check out the <a href="https://github.com/rust-lang/rust/releases/tag/1.70.0">detailed release notes for 1.70.0</a> on GitHub.</p>
<p>If you'd like to help us out by testing future releases, you might consider updating locally to use the beta channel (<code>rustup default beta</code>) or the nightly channel (<code>rustup default nightly</code>). Please <a href="https://github.com/rust-lang/rust/issues/new/choose">report</a> any bugs you might come across!</p>
<h2><a href="#whats-in-1700-stable" aria-hidden="true" class="anchor" id="whats-in-1700-stable"></a>What's in 1.70.0 stable</h2>
<h3><a href="#sparse-by-default-for-cratesio" aria-hidden="true" class="anchor" id="sparse-by-default-for-cratesio"></a>Sparse by default for crates.io</h3>
<p>Cargo's &quot;sparse&quot; protocol is now enabled by default for reading the index from crates.io. This feature was previously stabilized with <a href="https://blog.rust-lang.org/2023/03/09/Rust-1.68.0.html#cargos-sparse-protocol">Rust 1.68.0</a>, but still required configuration to use that with crates.io. The announced plan was to make that the default in 1.70.0, and here it is!</p>
<p>You should see substantially improved performance when fetching information from the crates.io index. Users behind a restrictive firewall will need to ensure that access to <code>https://index.crates.io</code> is available. If for some reason you need to stay with the previous default of using the git index hosted by GitHub, the <a href="https://doc.rust-lang.org/cargo/reference/config.html#registriescrates-ioprotocol"><code>registries.crates-io.protocol</code></a> config setting can be used to change the default.</p>
<p>One side-effect to note about changing the access method is that this also changes the path to the crate cache, so dependencies will be downloaded anew. Once you have fully committed to using the sparse protocol, you may want to clear out the old <code>$CARGO_HOME/registry/*/github.com-*</code> paths.</p>
<h3><a href="#oncecell-and-oncelock" aria-hidden="true" class="anchor" id="oncecell-and-oncelock"></a><code>OnceCell</code> and <code>OnceLock</code></h3>
<p>Two new types have been stabilized for one-time initialization of shared data, <code>OnceCell</code> and its thread-safe counterpart <code>OnceLock</code>. These can be used anywhere that immediate construction is not wanted, and perhaps not even possible like non-<code>const</code> data in global variables.</p>
<pre><code class="language-rust">use std::sync::OnceLock;

static WINNER: OnceLock&lt;&amp;str&gt; = OnceLock::new();

fn main() {
    let winner = std::thread::scope(|s| {
        s.spawn(|| WINNER.set(&quot;thread&quot;));

        std::thread::yield_now(); // give them a chance...

        WINNER.get_or_init(|| &quot;main&quot;)
    });

    println!(&quot;{winner} wins!&quot;);
}
</code></pre>
<p>Crates such as <code>lazy_static</code> and <code>once_cell</code> have filled this need in the past, but now these building blocks are part of the standard library, ported from <code>once_cell</code>'s <code>unsync</code> and <code>sync</code> modules. There are still more methods that may be stabilized in the future, as well as companion <code>LazyCell</code> and <code>LazyLock</code> types that store their initializing function, but this first step in stabilization should already cover many use cases.</p>
<h3><a href="#isterminal" aria-hidden="true" class="anchor" id="isterminal"></a><code>IsTerminal</code></h3>
<p>This newly-stabilized trait has a single method, <code>is_terminal</code>, to determine if a given file descriptor or handle represents a terminal or TTY. This is another case of standardizing functionality that existed in external crates, like <code>atty</code> and <code>is-terminal</code>, using the C library <code>isatty</code> function on Unix targets and similar functionality elsewhere. A common use case is for programs to distinguish between running in scripts or interactive modes, like presenting colors or even a full TUI when interactive.</p>
<pre><code class="language-rust">use std::io::{stdout, IsTerminal};

fn main() {
    let use_color = stdout().is_terminal();
    // if so, add color codes to program output...
}
</code></pre>
<h3><a href="#named-levels-of-debug-information" aria-hidden="true" class="anchor" id="named-levels-of-debug-information"></a>Named levels of debug information</h3>
<p>The <code>-Cdebuginfo</code> compiler option has previously only supported numbers 0..=2 for increasing amounts of debugging information, where Cargo defaults to 2 in dev and test profiles and 0 in release and bench profiles. These debug levels can now be set by name: &quot;none&quot; (0), &quot;limited&quot; (1), and &quot;full&quot; (2), as well as two new levels, &quot;line-directives-only&quot; and &quot;line-tables-only&quot;.</p>
<p>The Cargo and rustc documentation both called level 1 &quot;line tables only&quot; before, but it was more than that with information about all functions, just not types and variables. That level is now called &quot;limited&quot;, and the new &quot;line-tables-only&quot; level is further reduced to the minimum needed for backtraces with filenames and line numbers. This may eventually become the level used for <code>-Cdebuginfo=1</code>. The other <code>line-directives-only</code> level is intended for NVPTX profiling, and is otherwise not recommended.</p>
<p>Note that these named options are not yet available to be used via <code>Cargo.toml</code>. Support for that will be available in the next release 1.71.</p>
<h3><a href="#enforced-stability-in-the-test-cli" aria-hidden="true" class="anchor" id="enforced-stability-in-the-test-cli"></a>Enforced stability in the <code>test</code> CLI</h3>
<p>When <code>#[test]</code> functions are compiled, the executable gets a command-line interface from the <code>test</code> crate. This CLI has a number of options, including some that are not yet stabilized and require specifying <code>-Zunstable-options</code> as well, like many other commands in the Rust toolchain. However, while that's only intended to be allowed in nightly builds, that restriction wasn't active in <code>test</code> -- until now. Starting with 1.70.0, stable and beta builds of Rust will no longer allow unstable <code>test</code> options, making them truly nightly-only as documented.</p>
<p>There are known cases where unstable options may have been used without direct user knowledge, especially <code>--format json</code> used in IntelliJ Rust and other IDE plugins. Those projects are already adjusting to this change, and the status of JSON output can be followed in its <a href="https://github.com/rust-lang/rust/issues/49359">tracking issue</a>.</p>
<h3><a href="#stabilized-apis" aria-hidden="true" class="anchor" id="stabilized-apis"></a>Stabilized APIs</h3>
<ul>
<li><a href="https://doc.rust-lang.org/stable/std/num/struct.NonZeroI8.html#associatedconstant.MIN"><code>NonZero*::MIN/MAX</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/collections/struct.BinaryHeap.html#method.retain"><code>BinaryHeap::retain</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/collections/binary_heap/struct.IntoIter.html"><code>Default for std::collections::binary_heap::IntoIter</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/collections/btree_map/struct.IntoIter.html"><code>Default for std::collections::btree_map::{IntoIter, Iter, IterMut}</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/collections/btree_map/struct.IntoKeys.html"><code>Default for std::collections::btree_map::{IntoKeys, Keys}</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/collections/btree_map/struct.IntoKeys.html"><code>Default for std::collections::btree_map::{IntoValues, Values}</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/collections/btree_map/struct.Range.html"><code>Default for std::collections::btree_map::Range</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/collections/btree_set/struct.IntoIter.html"><code>Default for std::collections::btree_set::{IntoIter, Iter}</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/collections/btree_set/struct.Range.html"><code>Default for std::collections::btree_set::Range</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/alloc/collections/linked_list/struct.IntoIter.html"><code>Default for std::collections::linked_list::{IntoIter, Iter, IterMut}</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/alloc/vec/struct.IntoIter.html#impl-Default-for-IntoIter%3CT,+A%3E"><code>Default for std::vec::IntoIter</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/iter/struct.Chain.html"><code>Default for std::iter::Chain</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/iter/struct.Cloned.html"><code>Default for std::iter::Cloned</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/iter/struct.Copied.html"><code>Default for std::iter::Copied</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/iter/struct.Enumerate.html"><code>Default for std::iter::Enumerate</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/iter/struct.Flatten.html"><code>Default for std::iter::Flatten</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/iter/struct.Fuse.html"><code>Default for std::iter::Fuse</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/iter/struct.Rev.html"><code>Default for std::iter::Rev</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/slice/struct.Iter.html"><code>Default for std::slice::Iter</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/slice/struct.IterMut.html"><code>Default for std::slice::IterMut</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/alloc/rc/struct.Rc.html#method.into_inner"><code>Rc::into_inner</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/alloc/sync/struct.Arc.html#method.into_inner"><code>Arc::into_inner</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/cell/struct.OnceCell.html"><code>std::cell::OnceCell</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/option/enum.Option.html#method.is_some_and"><code>Option::is_some_and</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/ptr/struct.NonNull.html#method.slice_from_raw_parts"><code>NonNull::slice_from_raw_parts</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/result/enum.Result.html#method.is_ok_and"><code>Result::is_ok_and</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/result/enum.Result.html#method.is_err_and"><code>Result::is_err_and</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/sync/atomic/struct.AtomicU8.html#method.as_ptr"><code>std::sync::atomic::Atomic*::as_ptr</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/io/trait.IsTerminal.html"><code>std::io::IsTerminal</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/os/linux/net/trait.SocketAddrExt.html"><code>std::os::linux::net::SocketAddrExt</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/os/unix/net/struct.UnixDatagram.html#method.bind_addr"><code>std::os::unix::net::UnixDatagram::bind_addr</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/os/unix/net/struct.UnixDatagram.html#method.connect_addr"><code>std::os::unix::net::UnixDatagram::connect_addr</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/os/unix/net/struct.UnixDatagram.html#method.send_to_addr"><code>std::os::unix::net::UnixDatagram::send_to_addr</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/os/unix/net/struct.UnixListener.html#method.bind_addr"><code>std::os::unix::net::UnixListener::bind_addr</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/path/struct.Path.html#method.as_mut_os_str"><code>std::path::Path::as_mut_os_str</code></a></li>
<li><a href="https://doc.rust-lang.org/stable/std/sync/struct.OnceLock.html"><code>std::sync::OnceLock</code></a></li>
</ul>
<h3><a href="#other-changes" aria-hidden="true" class="anchor" id="other-changes"></a>Other changes</h3>
<p>Check out everything that changed in <a href="https://github.com/rust-lang/rust/releases/tag/1.70.0">Rust</a>, <a href="https://github.com/rust-lang/cargo/blob/master/CHANGELOG.md#cargo-170-2023-06-01">Cargo</a>, and <a href="https://github.com/rust-lang/rust-clippy/blob/master/CHANGELOG.md#rust-170">Clippy</a>.</p>
<h2><a href="#contributors-to-1700" aria-hidden="true" class="anchor" id="contributors-to-1700"></a>Contributors to 1.70.0</h2>
<p>Many people came together to create Rust 1.70.0. We couldn't have done it without all of you. <a href="https://thanks.rust-lang.org/rust/1.70.0/">Thanks!</a></p>

    </div>
  </div>
</section>

    <footer>
  <div class="w-100 mw-none ph3 mw8-m mw9-l center f3">
    <div class="row">
      <div class="four columns mt3 mt0-l" id="get-help">
        <h4>Get help!</h4>
        <ul>
          <li><a href="https://doc.rust-lang.org" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="mailto:core-team@rust-lang.org">Contact the Rust Team</a></li>
        </ul>
      </div>
      <div class="four columns mt3 mt0-l">
        <h4>Terms and policies</h4>
        <ul>
          <li><a href="https://www.rust-lang.org/policies/code-of-conduct">Code of Conduct</a></li>
          <li><a href="https://www.rust-lang.org/policies/licenses">Licenses</a></li>
          <li><a href="https://www.rust-lang.org/policies/media-guide">Logo Policy and Media Guide</a></li>
          <li><a href="https://www.rust-lang.org/policies/security">Security Disclosures</a></li>
          <li><a href="https://www.rust-lang.org/policies">All Policies</a></li>
        </ul>
      </div>
      <div class="four columns mt3 mt0-l">
        <h4>Social</h4>
        <div class="flex flex-row flex-wrap">
          <a href="https://twitter.com/rustlang" target="_blank" rel="noopener" alt="twitter link"><img src="../../../images/twitter.svg" alt="twitter logo" title="Twitter"/></a>
          <a href="https://www.youtube.com/channel/UCaYhcUwRBNscFNUKTjgPFiA" target="_blank" rel="noopener" alt="youtube link"><img style="padding-top: 6px; padding-bottom:6px" src="../../../images/youtube.svg" alt="youtube logo" title="YouTube"/></a>
          <a href="https://discord.gg/rust-lang" target="_blank" rel="noopener" alt="discord link"><img src="../../../images/discord.svg" alt="discord logo" title="Discord"/></a>
          <a href="https://github.com/rust-lang" target="_blank" rel="noopener" alt="github link"><img src="../../../images/github.svg" alt="github logo" title="GitHub"/></a>
        </div>
        <h4 class="mt4 mb3">RSS</h4>
        <ul>
          <li><a href="../../../feed.xml">Main Blog</a></li>
          <li><a href="../../../inside-rust/feed.xml">"Inside Rust" Blog</a></li>
        </ul>
      </div>

    </div>
    <div class="attribution">
      Maintained by the Rust Team. See a typo?
      <a href="https://github.com/rust-lang/blog.rust-lang.org" target="_blank" rel="noopener">Send a fix here</a>!
    </div>
  </div>
</footer>

<!-- scripts -->
<script src="../../../scripts/highlight.js"></script>

  </body>
</html>
